## Define the stages & order of execution

stages:
  - CLUSTER-SETUP
  - OPENEBS-SETUP
  - FUNCTIONAL
  - CHAOS
  - OPENEBS-CLEANUP
  - CLUSTER-CLEANUP
  
##########################################################################################

1LS01-CLUSTER-SETUP:
  image: openebs/openshift-ci:latest
  stage: CLUSTER-SETUP
  script:     
    - chmod 755 ./Openshift-EE/pipelines/stages/1-cluster-setup/1LS01-cluster-setup/cluster-state
    - ./Openshift-EE/pipelines/stages/1-cluster-setup/1LS01-cluster-setup/cluster-state

##########################################################################################

2LP01-OPENEBS-DEPLOY:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/stages/2-setup/2LP01-openebs-deploy/openebs-deploy
    - ./Openshift-EE/pipelines/stages/2-setup/2LP01-openebs-deploy/openebs-deploy

##########################################################################################

.func_test_template:
  image: openebs/openshift-ci:latest
  stage: FUNCTIONAL
  when: always
  dependencies:
    - 2LP01-OPENEBS-DEPLOY
     
3LF01-LOCALPV-DEVICE:
  extends: .func_test_template
  script: 
    - chmod 775 ./Openshift-EE/pipelines/stages/3-functional/3LF01-openebs-localpv-device/openebs-localpv-device
    - ./Openshift-EE/pipelines/stages/3-functional/3LF01-openebs-localpv-device/openebs-localpv-device

3LF02-LOCALPV-HOSTPATH:
  extends: .func_test_template
  script: 
    - chmod 775 ./Openshift-EE/pipelines/stages/3-functional/3LF02-openebs-localpv-hostpath/openebs-localpv-hostpath
    - ./Openshift-EE/pipelines/stages/3-functional/3LF02-openebs-localpv-hostpath/openebs-localpv-hostpath

3LF03-BACKUP-RESTORE-LOCALPV:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/stages/3-functional/3LF03-Backup-Restore-LocalPV/backup-restore-localpv
    - ./Openshift-EE/pipelines/stages/3-functional/3LF03-Backup-Restore-LocalPV/backup-restore-localpv

##########################################################################################

.chaos_test_template:
  image: openebs/openshift-ci:latest
  stage: CHAOS
  when: always
  dependencies:
    - 2LP01-OPENEBS-DEPLOY

4LC01-APP-KILL-LOCALPV-DEVICE:
  extends: .chaos_test_template
  script: 
    - chmod 775 ./Openshift-EE/pipelines/stages/4-chaos/4LC01-localpv-device-app-kill/app-kill
    - ./Openshift-EE/pipelines/stages/4-chaos/4LC01-localpv-device-app-kill/app-kill

4LC01-APP-KILL-LOCALPV-HOSTPATH:
  extends: .chaos_test_template
  script: 
    - chmod 775 ./Openshift-EE/pipelines/stages/4-chaos/4LC01-localpv-hostpath-app-kill/app-kill
    - ./Openshift-EE/pipelines/stages/4-chaos/4LC01-localpv-hostpath-app-kill/app-kill

##########################################################################################

.cleanup_test_template:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-CLEANUP
  when: always
  dependencies:
    - 2LP01-OPENEBS-DEPLOY
                
5LD01-OPENEBS-UNINSTALL:
  extends: .cleanup_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/stages/5-cleanup/5LD01-openebs-cleanup/openebs-cleanup
    - ./Openshift-EE/pipelines/stages/5-cleanup/5LD01-openebs-cleanup/openebs-cleanup

##########################################################################################

5LD02-CLUSTER-DELETE:
  image: openebs/openshift-ci:latest
  stage: CLUSTER-CLEANUP
  when: always
  dependencies:
    - 1LS01-CLUSTER-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/stages/5-cleanup/5LD02-cluster-cleanup/cluster-cleanup
    - ./Openshift-EE/pipelines/stages/5-cleanup/5LD02-cluster-cleanup/cluster-cleanup