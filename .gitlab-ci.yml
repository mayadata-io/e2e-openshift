## Define the stages & order of execution
## Job ID's are in following format
## pipeline_stage_no + J (for jiva) + S/P/F/C/I/D + job count
## S ==> Setup cluster
## P ==> Provider setup
## F ==> Functional tests
## C ==> Chaos test
## I ==> Infra-chaos test
## D ==> Cluster deletion or revert

stages:
  - CLUSTER-SETUP
  - OPENEBS-SETUP
  - FUNCTIONAL
  - CHAOS
  # - INFRA-CHAOS
  - OPENEBS-CLEANUP
  - CLUSTER-CLEANUP
  
##########################################################################################

1JS01-OPENSHIFT-CLUSTER:
  image: openebs/openshift-ci:latest
  stage: CLUSTER-SETUP
  script:     
    - chmod 755 ./Openshift-EE/pipelines/OpenEBS-base/stages/1-cluster-setup/1JS01-cluster-setup/cluster-state
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/1-cluster-setup/1JS01-cluster-setup/cluster-state

##########################################################################################

2JP01-OPENEBS-DEPLOY:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP01-openebs-deploy/openebs-deploy
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP01-openebs-deploy/openebs-deploy

2JP02-STORAGE-CLASSES:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP02-storage-classes/storage-classes
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP02-storage-classes/storage-classes
  
2JP03-NFSv4-JIVA-PROVISION:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP03-nfsv4-jiva-provision/nfsv4-jiva-provision
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/2JP03-nfsv4-jiva-provision/nfsv4-jiva-provision

BDD-JIVA-CLONE:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-clone
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-clone

BDD-JIVA-SNAPSHOT:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-snapshot
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-snapshot
    
BDD-JIVA-VOLUME:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-volume
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/jiva-volume

BDD-JIVA-NODE-STICKINESS:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-SETUP
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/node-stickiness
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/2-setup/BDD/Jiva/node-stickiness

##########################################################################################

.func_test_template:
  image: openebs/openshift-ci:latest
  stage: FUNCTIONAL
  when: always
  dependencies:
    - 2JP01-OPENEBS-DEPLOY
     
3JF01-BACKUP-RESTORE-JIVA:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF01-Backup-Restore-Jiva/backup-restore-jiva
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF01-Backup-Restore-Jiva/backup-restore-jiva

3JF02-JIVA-APP-TARGET-AFFINITY:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF02-Jiva-App-Target-affinity/app-target-affinity
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF02-Jiva-App-Target-affinity/app-target-affinity

3JF03-JIVA-MEMORY-CONSUMPTION:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF03-Jiva-Memory-Consumption/memory-consumption
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF03-Jiva-Memory-Consumption/memory-consumption

# 3JF04-JIVA-STS-APP-TARGET-AFFINITY:
#  extends: .func_test_template
#  script:
#    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF04-Jiva-sts-App-Target-Affinity/sts-app-target-affinity
#    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF04-Jiva-sts-App-Target-Affinity/sts-app-target-affinity

3JF05-JIVA-APP-SCALEUP:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF05-Jiva-sts-App-replica-scaleup/app-replica-scaleup
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF05-Jiva-sts-App-replica-scaleup/app-replica-scaleup

3JF06-JIVA-DATA-INTEGRITY:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF06-Jiva-Data-Integrity/data-integrity
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF06-Jiva-Data-Integrity/data-integrity

3JF07-JIVA-VOLUME-SCALEUP:
  extends: .func_test_template
  script: 
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF07-Jiva-Volume-scaleup/jiva-volume-scaleup
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF07-Jiva-Volume-scaleup/jiva-volume-scaleup

3JF08-APP-DEPLOY-JIVA-RWX:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF08-app-deploy-jiva-RWX/app-deploy-jiva-rwx
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF08-app-deploy-jiva-RWX/app-deploy-jiva-rwx

3JF09-JIVA-SNAPSHOT:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF09-Jiva-snapshot/jiva-snapshot
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF09-Jiva-snapshot/jiva-snapshot

3JF10-JIVA-SNAPSHOT-CLONE:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF10-Jiva-snapshot-clone/jiva-snapshot-clone
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF10-Jiva-snapshot-clone/jiva-snapshot-clone

3JF11-JIVA-DELETE-AUTOGEN-SNAPSHOT:
  extends: .func_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF11-Jiva-Snapshot-Delete/jiva-snapshot-delete
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/3-functional/3JF11-Jiva-Snapshot-Delete/jiva-snapshot-delete

##########################################################################################

.chaos_test_template:
  image: openebs/openshift-ci:latest
  stage: CHAOS
  when: always
  dependencies:
    - 2JP01-OPENEBS-DEPLOY

#4JC01-JIVA-APP-KILL:
#  extends: .chaos_test_template
#  script:
#    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC01-Jiva-app-kill/jiva-app-kill
#    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC01-Jiva-app-kill/jiva-app-kill

4JC02-JIVA-CONTROLLER-KILL:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC02-jiva-controller-kill/controller-kill
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC02-jiva-controller-kill/controller-kill

4JC03-JIVA-REPLICA-FAILURE:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC03-Jiva-replica-failure/jiva-replica-failure
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC03-Jiva-replica-failure/jiva-replica-failure

4JC04-JIVA-SINGLE-REPLICA-FAILURE:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC04-jiva-single-replica-failure/single-replica-failure
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC04-jiva-single-replica-failure/single-replica-failure

4JC05-JIVA-REVISION-COUNTER:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC05-jiva-revision-counter/jiva-revision-counter
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC05-jiva-revision-counter/jiva-revision-counter
 
4JC06-JIVA-CONTROLLER-NETWORK-DELAY:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC06-Jiva-controller-network-delay/controller-network-delay
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC06-Jiva-controller-network-delay/controller-network-delay

4JC07-JIVA-REPLICA-NODE-AFFINITY:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC07-jiva-replica-node-affinity/replica-node-affinity
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC07-jiva-replica-node-affinity/replica-node-affinity

4JC08-JIVA-CONTROLLER-FAILURE-REPLICA-SCALEUP:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC08-Jiva-controller-failure-new-replica-rebuild/jiva-controller-failure-new-replica-rebuild
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC08-Jiva-controller-failure-new-replica-rebuild/jiva-controller-failure-new-replica-rebuild
  
4JC09-NFS-APP-KILL-JIVA:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC09-nfs-app-kill-jiva/nfs-app-kill-jiva
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC09-nfs-app-kill-jiva/nfs-app-kill-jiva

4JC10-NFS-CTRL-KILL-JIVA:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC10-nfs-ctrl-kill-jiva/nfs-ctrl-kill-jiva
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC10-nfs-ctrl-kill-jiva/nfs-ctrl-kill-jiva

4JC11-NFS-CTRL-CONTAINER-KILL-JIVA:
  extends: .chaos_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC11-nfs-ctrl-container-kill/nfs-ctrl-container-kill
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/4-chaos/4JC11-nfs-ctrl-container-kill/nfs-ctrl-container-kill

##########################################################################################

.infra_chaos_test_template:
  image: openebs/openshift-ci:latest
  stage: INFRA-CHAOS
  when: always
  dependencies:
    - 2JP01-OPENEBS-DEPLOY   

##########################################################################################

.cleanup_test_template:
  image: openebs/openshift-ci:latest
  stage: OPENEBS-CLEANUP
  when: always
  dependencies:
    - 2JP01-OPENEBS-DEPLOY
              
6JD01-OPENEBS-UNINSTALL:
  extends: .cleanup_test_template
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/6-cleanup/6JD01-openebs-cleanup/openebs-cleanup
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/6-cleanup/6JD01-openebs-cleanup/openebs-cleanup

##########################################################################################

CLUSTER-DELETE:
  image: openebs/openshift-ci:latest
  stage: CLUSTER-CLEANUP
  when: always
  dependencies:
    - 1JS01-OPENSHIFT-CLUSTER
  script:
    - chmod 775 ./Openshift-EE/pipelines/OpenEBS-base/stages/6-cleanup/cluster-cleanup/cluster-cleanup
    - ./Openshift-EE/pipelines/OpenEBS-base/stages/6-cleanup/cluster-cleanup/cluster-cleanup
